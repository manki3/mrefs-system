{% extends "base.html" %}
{% block content %}

<div class="section-title">{{ collection.title }}</div>

<div class="memo-card">

    <div id="memo-view" {% if not collection.memo %}style="display:none"{% endif %}>
        <div class="memo-text" id="memo-text">{{ collection.memo }}</div>
        <div class="memo-actions">
            <button onclick="editMemo()">수정</button>
            <button onclick="deleteMemo()">삭제</button>
        </div>
    </div>

    <div id="memo-edit" {% if collection.memo %}style="display:none"{% endif %}>
        <textarea id="memo-input" class="memo-input" maxlength="200"
placeholder="메모를 입력하세요 (최대 200자)">{{ collection.memo or '' }}</textarea>


        <div class="memo-actions">
            <button onclick="saveMemo()">저장</button>
            <button onclick="cancelMemo()">취소</button>
        </div>
    </div>

</div>


<div class="sort-bar">
    <a href="?sort=name">이름순</a>
    <a href="?sort=area_desc">큰평수</a>
    <a href="?sort=area_asc">작은평수</a>
    <a href="?sort=rent_desc">월세높은순</a>
    <a href="?sort=rent_asc">월세낮은순</a>
</div>

<div class="list-detail-container">

{% for p in properties %}

<div class="detail-row">

    <div class="card property-card" onclick="location.href='/property/{{ p.id }}?from_collection_id={{ collection.id }}'">

        <div class="property-header">
            <div class="property-title">{{ p.building_name }}</div>

            <div class="property-center">
                전용 {{ p.exclusive_area }}평
            </div>

            <div class="property-price">
                {% if p.deposit and p.rent %}
                    임대 {{ p.deposit }}/{{ p.rent }}
                {% else %}
                    매매 {{ p.sale_price }}
                {% endif %}
            </div>
        </div>


    </div>

    <div class="remove-wrap mobile-hide-remove" onclick="event.stopPropagation();">
    <a href="{{ url_for('remove_from_collection', collection_id=collection.id, property_id=p.id) }}" class="remove-btn">
        제거
    </a>
</div>



</div>

{% endfor %}

</div>



<style>

/* ===== 헤더 ===== */
.section-title {
    font-size: 32px;
    font-weight: 900;
    margin-bottom: 18px;
    padding: 12px 16px;
    border-radius: 10px;
    background: linear-gradient(to right, #eef4ff, transparent);
    border-left: 8px solid #2d7ff9;
}

/* ===== 정렬바 ===== */
.sort-bar {
    margin-bottom: 18px;
}

.sort-bar a {
    margin-right: 8px;
    padding: 7px 14px;
    border-radius: 8px;
    background: #f1f3f7;
    text-decoration: none;
    color: #333;
    font-weight: 600;
    transition: 0.15s;
}

.sort-bar a:hover {
    background: #e4ecff;
    color: #2d7ff9;
}

/* ===== 카드 레이아웃 ===== */
.detail-row {
    display: flex;
    gap: 15px;
    align-items: stretch;
    margin-bottom: 15px;
}

.property-card {
    flex: 3;
    padding: 18px 18px;
    display:flex;
    align-items:center;
    height:100%;
}


/* 제거 버튼 영역 (카드 아님) */
.remove-wrap{
    display:flex;
    align-items:stretch;
    min-width:90px;
}


/* 버튼 */
.remove-btn{
    background:#ff6b6b;
    color:white;
    border-radius:10px;
    text-decoration:none;
    font-weight:bold;
    white-space:nowrap;
    transition:.15s;

    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0 16px;
}


.remove-btn:hover{
    background:#ff5252;
}






/* ===== 카드 내부 ===== */
.property-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    width:100%;
    height:100%;
}



.property-title {
    font-size: 22px;
    font-weight: bold;
    line-height: 1.4;
}

.property-center {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
}

.property-price {
    font-size: 20px;
    font-weight: bold;
    color: #2d7ff9;
}

.property-type {
    color: #666;
    font-size: 14px;
}

/* ===== 제거 버튼 ===== */
.remove-btn {
    background: #ff6b6b;
    color: white;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
    transition: 0.15s;

    width:100%;
    height:auto;
    padding:12px 0;
    display:flex;
    align-items:center;
    justify-content:center;
}




.remove-btn:hover {
    background: #ff5252;
    transform: translateY(-1px);
}


.memo-card {
    background: #fffbe9;
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 18px;
    border: 1px solid #f1e2b8;
}

.memo-text {
    white-space: pre-wrap;
    line-height: 1.5;
    margin-bottom: 10px;
}

.memo-actions button {
    margin-right: 6px;
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: #2d7ff9;
    color: white;
    cursor: pointer;
}

.memo-actions button:last-child {
    background: #888;
}

.memo-card textarea {
    width: 100%;
    height: 80px;
    resize: none;
    border-radius: 8px;
    padding: 8px;
    box-sizing: border-box;
}


/* 모바일에서는 카드 단일열 레이아웃 */
@media (max-width:800px){

    .mobile-hide-remove{
        display:none !important;
    }

    .detail-row{
        display:block;
    }

    .property-card{
        width:100%;
        box-sizing:border-box;
    }

}


/* 모바일에서 카드 좌우 기준선을 상단 영역과 맞춤 */
@media (max-width:800px){
    .list-detail-container{
        padding:0 10px;
        box-sizing:border-box;
    }
}


@media (max-width:800px){
  .mobile-hide-remove{ display:none !important; }
}


</style>



<script>


function showToast(msg){
    let t = document.getElementById("toast");
    if(!t){
        t=document.createElement("div");
        t.id="toast";
        t.style.position="fixed";
        t.style.bottom="30px";
        t.style.left="50%";
        t.style.transform="translateX(-50%)";
        t.style.background="#2d7ff9";
        t.style.color="white";
        t.style.padding="10px 18px";
        t.style.borderRadius="10px";
        t.style.boxShadow="0 8px 20px rgba(0,0,0,0.15)";
        document.body.appendChild(t);
    }
    t.innerText=msg;
    t.style.opacity="1";
    setTimeout(()=>{t.style.opacity="0"},1200);
}



function editMemo(){
    document.getElementById("memo-view").style.display="none";
    document.getElementById("memo-edit").style.display="block";
}

function cancelMemo(){
    document.getElementById("memo-view").style.display="block";
    document.getElementById("memo-edit").style.display="none";
}

function saveMemo(){
    const text = document.getElementById("memo-input").value;

    fetch("/api/collection/{{ collection.id }}/memo",{
        method:"POST",
        headers:{ "Content-Type":"application/json"},
        body: JSON.stringify({memo:text})
    })
    .then(r=>r.json())
    .then(data=>{
        document.getElementById("memo-text").innerText=data.memo;
        cancelMemo();
        showToast("메모 저장됨");

    });
}

function deleteMemo(){
    if(!confirm("메모 삭제할까요?")) return;

    fetch("/api/collection/{{ collection.id }}/memo",{method:"DELETE"})
    .then(()=>{
        document.getElementById("memo-view").style.display="none";
        document.getElementById("memo-edit").style.display="block";
        document.getElementById("memo-input").value="";
        showToast("메모 삭제됨");

    });



}



// PC에서 memo None 자동 제거
document.addEventListener("DOMContentLoaded", function(){
    const memo = document.querySelector(".memo-input");
    if(!memo) return;

    memo.addEventListener("focus", function(){
        if(memo.value.trim() === "None"){
            memo.value = "";
        }
    });
    // 최초 로드시 None 제거 (브라우저 캐시 대응)
if(memo.value.trim() === "None"){
    memo.value = "";
}

});

</script>

{% endblock %}
