{% extends "base.html" %}
{% block content %}

<div class="section-title">{{ collection.title }}</div>

<div class="memo-card">

    <div id="memo-view" {% if not collection.memo %}style="display:none"{% endif %}>
        <div class="memo-text" id="memo-text">{{ collection.memo }}</div>
        <div class="memo-actions">
            <button onclick="editMemo()">ìˆ˜ì •</button>
            <button onclick="deleteMemo()">ì‚­ì œ</button>
        </div>
    </div>

    <div id="memo-edit" {% if collection.memo %}style="display:none"{% endif %}>
        <textarea id="memo-input" class="memo-input" maxlength="200"
placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 200ì)">{{ collection.memo or '' }}</textarea>


        <div class="memo-actions">
            <button onclick="saveMemo()">ì €ì¥</button>
            <button onclick="cancelMemo()">ì·¨ì†Œ</button>
        </div>
    </div>

</div>


<div class="sort-bar">
    <a href="?sort=name">ì´ë¦„ìˆœ</a>
    <a href="?sort=area_desc">í°í‰ìˆ˜</a>
    <a href="?sort=area_asc">ì‘ì€í‰ìˆ˜</a>
    <a href="?sort=rent_desc">ì›”ì„¸ë†’ì€ìˆœ</a>
    <a href="?sort=rent_asc">ì›”ì„¸ë‚®ì€ìˆœ</a>
</div>

<div class="list-detail-container">

{% for p in properties %}

<div class="detail-row">

    <div class="card property-card" onclick="location.href='/property/{{ p.id }}?from_collection_id={{ collection.id }}'">

        <div class="property-header">
            <div class="property-title">{{ p.building_name }}</div>

            <div class="property-center">
                ì „ìš© {{ p.exclusive_area }}í‰
            </div>

            <div class="property-price">
                {% if p.deposit and p.rent %}
                    ì„ëŒ€ {{ p.deposit }}/{{ p.rent }}
                {% else %}
                    ë§¤ë§¤ {{ p.sale_price }}
                {% endif %}
            </div>
        </div>


    </div>

    <div class="remove-wrap mobile-hide-remove" onclick="event.stopPropagation();">
    <a href="{{ url_for('remove_from_collection', collection_id=collection.id, property_id=p.id) }}" class="remove-btn">
        ì œê±°
    </a>
</div>



</div>

{% endfor %}

</div>



<style>

/* ===== í—¤ë” ===== */
.section-title {
    font-size: 32px;
    font-weight: 900;
    margin-bottom: 18px;
    padding: 12px 16px;
    border-radius: 10px;
    background: linear-gradient(to right, #eef4ff, transparent);
    border-left: 8px solid #2d7ff9;
}

/* ===== ì •ë ¬ë°” ===== */
.sort-bar {
    margin-bottom: 18px;
}

.sort-bar a {
    margin-right: 8px;
    padding: 7px 14px;
    border-radius: 8px;
    background: #f1f3f7;
    text-decoration: none;
    color: #333;
    font-weight: 600;
    transition: 0.15s;
}

.sort-bar a:hover {
    background: #e4ecff;
    color: #2d7ff9;
}

/* ===== ì¹´ë“œ ë ˆì´ì•„ì›ƒ ===== */
.detail-row {
    display: flex;
    gap: 15px;
    align-items: stretch;
    margin-bottom: 15px;
}

.property-card {
    flex: 3;
    padding: 20px 22px;
    display:flex;
    align-items:center;
    height:100%;
}


/* ì œê±° ë²„íŠ¼ ì˜ì—­ (ì¹´ë“œ ì•„ë‹˜) */
.remove-wrap{
    display:flex;
    align-items:stretch;
    min-width:90px;
}


/* ë²„íŠ¼ */
.remove-btn{
    background:#ff6b6b;
    color:white;
    border-radius:10px;
    text-decoration:none;
    font-weight:bold;
    white-space:nowrap;
    transition:.15s;

    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0 16px;
}


.remove-btn:hover{
    background:#ff5252;
}






/* ===== ì¹´ë“œ ë‚´ë¶€ ===== */
.property-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    width:100%;
    height:100%;
}



.property-title {
    font-size: 22px;
    font-weight: bold;
    line-height: 1.4;
}

.property-center {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
}

.property-price {
    font-size: 20px;
    font-weight: bold;
    color: #2d7ff9;
}

.property-type {
    color: #666;
    font-size: 14px;
}

/* ===== ì œê±° ë²„íŠ¼ ===== */
.remove-btn {
    background: #ff6b6b;
    color: white;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
    transition: 0.15s;

    width:100%;
    height:auto;
    padding:12px 0;
    display:flex;
    align-items:center;
    justify-content:center;
}




.remove-btn:hover {
    background: #ff5252;
    transform: translateY(-1px);
}


.memo-card {
    background: #fffbe9;
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 18px;
    border: 1px solid #f1e2b8;
}

.memo-text {
    white-space: pre-wrap;
    line-height: 1.5;
    margin-bottom: 10px;
}

.memo-actions button {
    margin-right: 6px;
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: #2d7ff9;
    color: white;
    cursor: pointer;
}

.memo-actions button:last-child {
    background: #888;
}

.memo-card textarea {
    width: 100%;
    height: 80px;
    resize: none;
    border-radius: 8px;
    padding: 8px;
    box-sizing: border-box;
}


/* ğŸ“± ëª¨ë°”ì¼ì—ì„œëŠ” ì»¬ë ‰ì…˜ ëª©ë¡ ì œê±°ë²„íŠ¼ ìˆ¨ê¹€ */
@media (max-width:800px){
    .mobile-hide-remove{
        display:none;
    }
}

@media (max-width:800px){
  .mobile-hide-remove{ display:none !important; }
}


</style>



<script>


function showToast(msg){
    let t = document.getElementById("toast");
    if(!t){
        t=document.createElement("div");
        t.id="toast";
        t.style.position="fixed";
        t.style.bottom="30px";
        t.style.left="50%";
        t.style.transform="translateX(-50%)";
        t.style.background="#2d7ff9";
        t.style.color="white";
        t.style.padding="10px 18px";
        t.style.borderRadius="10px";
        t.style.boxShadow="0 8px 20px rgba(0,0,0,0.15)";
        document.body.appendChild(t);
    }
    t.innerText=msg;
    t.style.opacity="1";
    setTimeout(()=>{t.style.opacity="0"},1200);
}



function editMemo(){
    document.getElementById("memo-view").style.display="none";
    document.getElementById("memo-edit").style.display="block";
}

function cancelMemo(){
    document.getElementById("memo-view").style.display="block";
    document.getElementById("memo-edit").style.display="none";
}

function saveMemo(){
    const text = document.getElementById("memo-input").value;

    fetch("/api/collection/{{ collection.id }}/memo",{
        method:"POST",
        headers:{ "Content-Type":"application/json"},
        body: JSON.stringify({memo:text})
    })
    .then(r=>r.json())
    .then(data=>{
        document.getElementById("memo-text").innerText=data.memo;
        cancelMemo();
        showToast("ë©”ëª¨ ì €ì¥ë¨");

    });
}

function deleteMemo(){
    if(!confirm("ë©”ëª¨ ì‚­ì œí• ê¹Œìš”?")) return;

    fetch("/api/collection/{{ collection.id }}/memo",{method:"DELETE"})
    .then(()=>{
        document.getElementById("memo-view").style.display="none";
        document.getElementById("memo-edit").style.display="block";
        document.getElementById("memo-input").value="";
        showToast("ë©”ëª¨ ì‚­ì œë¨");

    });



}



// PCì—ì„œ memo None ìë™ ì œê±°
document.addEventListener("DOMContentLoaded", function(){
    const memo = document.querySelector(".memo-input");
    if(!memo) return;

    memo.addEventListener("focus", function(){
        if(memo.value.trim() === "None"){
            memo.value = "";
        }
    });
    // ìµœì´ˆ ë¡œë“œì‹œ None ì œê±° (ë¸Œë¼ìš°ì € ìºì‹œ ëŒ€ì‘)
if(memo.value.trim() === "None"){
    memo.value = "";
}

});

</script>

{% endblock %}
