<h1>ë§¤ë¬¼ ê²€ìƒ‰</h1>

<div style="margin-bottom:10px;">
    <button class="big-btn home-btn" onclick="goHome()">í™ˆìœ¼ë¡œ ê°€ê¸°</button>

    <button class="big-btn list-btn" onclick="goList()" style="margin-left:10px;">
        ğŸ“‹ ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸ë¡œ
    </button>
</div>

<form method="GET" id="searchForm">

ê±´ë¬¼ëª…: 
<input type="text" name="building" value="{{ request.args.get('building', '') }}"><br><br>


ë§¤ë¬¼ì¢…ë¥˜:
<select name="property_type">
    <option value="">ì „ì²´</option>
    <option value="ìƒê°€" {% if request.args.get('property_type') == 'ìƒê°€' %}selected{% endif %}>ìƒê°€</option>
    <option value="ì‚¬ë¬´ì‹¤" {% if request.args.get('property_type') == 'ì‚¬ë¬´ì‹¤' %}selected{% endif %}>ì‚¬ë¬´ì‹¤</option>
    <option value="ì£¼ê±°ìš©" {% if request.args.get('property_type') == 'ì£¼ê±°ìš©' %}selected{% endif %}>ì£¼ê±°ìš©</option>
</select>

<br><br>


ê±°ë˜êµ¬ë¶„:
<select name="category" id="category" onchange="toggleInputs()">
    <option value="" {% if request.args.get('category') == '' %}selected{% endif %}>ì „ì²´</option>
    <option value="ì›”ì„¸" {% if request.args.get('category') == 'ì›”ì„¸' %}selected{% endif %}>ì›”ì„¸</option>
    <option value="ë§¤ë§¤" {% if request.args.get('category') == 'ë§¤ë§¤' %}selected{% endif %}>ë§¤ë§¤</option>
</select>

<br><br>


<div id="rentInputs">
ë³´ì¦ê¸ˆ:
<input type="number" name="min_deposit" value="{{ request.args.get('min_deposit', '') }}"> ~
<input type="number" name="max_deposit" value="{{ request.args.get('max_deposit', '') }}"><br><br>

ì›”ì„¸:
<input type="number" name="min_rent" value="{{ request.args.get('min_rent', '') }}"> ~
<input type="number" name="max_rent" value="{{ request.args.get('max_rent', '') }}"><br><br>
</div>

<div id="saleInputs">
ë§¤ë§¤ê°€:
<input type="number" name="min_sale" value="{{ request.args.get('min_sale', '') }}"> ~
<input type="number" name="max_sale" value="{{ request.args.get('max_sale', '') }}"><br><br>
</div>

ì „ìš©ë©´ì (í‰):
<input type="number" name="min_area" value="{{ request.args.get('min_area', '') }}"> ~
<input type="number" name="max_area" value="{{ request.args.get('max_area', '') }}"><br><br>

<button type="submit" class="big-btn search-btn">ê²€ìƒ‰</button>

</form>

<hr>

{% if properties is not none %}

<h2>ê²€ìƒ‰ ê²°ê³¼</h2>

<div style="text-align:center; margin-bottom:10px;">

<form method="GET" id="sortForm">

{% for key, value in request.args.items() %}
    {% if key != 'sort' %}
        <input type="hidden" name="{{ key }}" value="{{ value }}">
    {% endif %}
{% endfor %}

ì •ë ¬:
<select name="sort" id="sortSelect" onchange="toggleSortOptions()">
    <option value="">ì •ë ¬ ì•ˆí•¨</option>

    <option value="rent_asc" class="rentOption" {% if request.args.get('sort') == 'rent_asc' %}selected{% endif %}>ì›”ì„¸ ë‚®ì€ìˆœ</option>
    <option value="rent_desc" class="rentOption" {% if request.args.get('sort') == 'rent_desc' %}selected{% endif %}>ì›”ì„¸ ë†’ì€ìˆœ</option>

    <option value="sale_asc" class="saleOption" {% if request.args.get('sort') == 'sale_asc' %}selected{% endif %}>ë§¤ë§¤ê°€ ë‚®ì€ìˆœ</option>
    <option value="sale_desc" class="saleOption" {% if request.args.get('sort') == 'sale_desc' %}selected{% endif %}>ë§¤ë§¤ê°€ ë†’ì€ìˆœ</option>

    <option value="area_asc" {% if request.args.get('sort') == 'area_asc' %}selected{% endif %}>í‰ìˆ˜ ì‘ì€ìˆœ</option>
    <option value="area_desc" {% if request.args.get('sort') == 'area_desc' %}selected{% endif %}>í‰ìˆ˜ í°ìˆœ</option>
</select>

<button type="submit">ì •ë ¬ ì ìš©</button>

</form>

</div>

<table border="1" cellpadding="5">
<tr>
    <th>ì¢…ë¥˜</th> 
    <th>ê±´ë¬¼ëª…</th>
    <th>ì „ìš©</th>
    <th>ë³´ì¦ê¸ˆ</th>
    <th>ì›”ì„¸</th>
    <th>ë§¤ë§¤ê°€</th>
    <th>ë¦¬ìŠ¤íŠ¸ ë‹´ê¸°</th>
</tr>

{% for p in properties %}
<tr>
    <td>[{{ p.property_type }}]</td>
    <td>{{ p.building_name }}</td>
    <td>{{ p.exclusive_area }}</td>
    <td>{{ p.deposit }}</td>
    <td>{{ p.rent }}</td>
    <td>{{ format_sale_price_korean(p.sale_price) }}</td>

    <td>

{% if p.id in existing_ids %}

    <button disabled style="background:#ccc; color:#666; border:none; padding:6px 12px; border-radius:4px;">
        âœ” ì´ë¯¸ ë‹´ê¹€
    </button>

{% else %}

<form method="POST" action="{{ url_for('add_to_collection') }}">

<input type="hidden" name="property_id" value="{{ p.id }}">

{% for key, value in request.args.items() %}
    <input type="hidden" name="{{ key }}" value="{{ value }}">
{% endfor %}

<select name="collection_id">
    {% for c in collections %}
    <option value="{{ c.id }}">{{ c.title }}</option>
    {% endfor %}
</select>

<button type="submit">ë‹´ê¸°</button>

</form>

{% endif %}

</td>

</tr>
{% endfor %}

</table>

{% endif %}


<style>
.big-btn {
    font-size: 18px;
    padding: 12px 24px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: bold;
}

.home-btn {
    background-color: #666;
    color: white;
}

.search-btn {
    background-color: #2d7ff9;
    color: white;
}

.list-btn {
    background-color: #ff8c00;
    color: white;
}


.big-btn:hover {
    opacity: 0.9;
}
</style>


<script>

function toggleInputs() {
    var category = document.getElementById("category").value;

    if (category == "ì›”ì„¸") {
        document.getElementById("rentInputs").style.display = "block";
        document.getElementById("saleInputs").style.display = "none";

    } else if (category == "ë§¤ë§¤") {
        document.getElementById("rentInputs").style.display = "none";
        document.getElementById("saleInputs").style.display = "block";

    } else {
        document.getElementById("rentInputs").style.display = "block";
        document.getElementById("saleInputs").style.display = "block";
    }
}

function toggleSortOptions() {

    var category = document.getElementById("category").value;

    if (category == "ì›”ì„¸") {
        document.querySelectorAll(".rentOption").forEach(e => e.style.display = "block");
        document.querySelectorAll(".saleOption").forEach(e => e.style.display = "none");

    } else if (category == "ë§¤ë§¤") {
        document.querySelectorAll(".rentOption").forEach(e => e.style.display = "none");
        document.querySelectorAll(".saleOption").forEach(e => e.style.display = "block");

    } else {
        document.querySelectorAll(".rentOption").forEach(e => e.style.display = "block");
        document.querySelectorAll(".saleOption").forEach(e => e.style.display = "block");
    }
}

function goHome() {
    window.location.href = "/";
}

function goList() {
    window.location.href = "/collections";
}


window.onload = function() {
    toggleInputs();
    toggleSortOptions();

    if (window.history && window.history.pushState) {
        history.pushState(null, "", location.href);

        window.onpopstate = function() {
            window.location.href = "/";
        };
    }
};

</script>
